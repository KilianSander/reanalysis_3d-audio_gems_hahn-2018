---
title: "Reanalysis of a Data set"
author: "Kilian Sander, Yves Wycisk, Reinhard Kopiez"
date: '2022'
output: html_document
csl: inst/apa.csl
---
# Preparation
## Data, Packages, and Design
Load the data:
```{r dataset, messages=FALSE}
load("data/data_raw.Rda")
```
Load relevant packages:
```{r packages, message=FALSE, warning=FALSE, results='hide'}
sapply(c("tidyverse", "MANOVA.RM"), require, character.only = T)
```
Prepare the design with vectors:
```{r formats and GEMS, message=FALSE}
formats <- c("stereo", "surround", "auro")
gems_factors <- c("wonder", "transcendence", "tenderness", "nostalgia",
                  "peacefulness", "power", "joyful_activation", "tension",
                  "sadness")
# item to factor mapping
wonder <- c("moved", "filled_with_wonder", "allured")
transcendence <- c("feeling_of_transcendence", "fascinated", "overwhelmed")
tenderness <- c("affectionate", "tender", "mellowed")
nostalgia <- c("sentimental", "dreamy", "nostalgic")
peacefulness <- c("calm", "serene", "soothed")
power <- c("energetic", "triumphant", "strong")
joyful_activation <- c("joyful", "animated", "bouncy")
tension <- c("agitated", "nervous", "tense")
sadness <- c("sad", "sorrowful", "tearful")
```
## Filtering
Exclude a participant if there are at least two `NA`s for a GEMS factor of one stimulus:
```{r filter cases, message=FALSE}
data_raw$complete <- TRUE
for (p in data_raw$participant) {
  part_data <- data_raw %>% filter(participant == p)
  for (excerpt in c("a", "b")) {
    for (format in formats) {
      for (factor in gems_factors) {
        temp_data <- part_data %>%
          dplyr::select(starts_with(paste(excerpt, format, get(factor), sep = "_")))
        nas <- temp_data %>% t() %>% is.na() %>% sum()
        if (nas > 1) {
          data_raw$complete[p] <- FALSE
        }
      }
    }
  }
}
rm(part_data, temp_data, nas, p, format, excerpt)
data_filtered <- data_raw %>% filter(complete==TRUE)
N <- length(data_filtered$participant)
```
After removing incomplete cases the data set contains `r N` participants.

## Scoring
Calculate mean values for each item per format:
```{r item means, message=FALSE, warning=FALSE}
for (format in formats) {
  for (factor in gems_factors) {
    for (item in get(factor)) {
      item_mean_vector <- data_filtered %>%
        select(ends_with(paste0(format, "_", item))) %>%
        rowMeans(na.rm = TRUE)
      eval(str2expression(paste0("data_filtered$",
                                 format, "_", item,
                                 " <- item_mean_vector")))
    }
  }
}
rm(item, item_mean_vector)
data_filtered <- data_filtered %>% mutate_all(~ifelse(is.nan(.), NA, .))
```
Calculate the mean of each factor per format across its items:
```{r factor means, message=FALSE, warning=FALSE}
for (format in formats) {
  for (factor in gems_factors) {
    factor_mean_vector <- data_filtered %>%
      select(paste0(format, "_", get(factor))) %>% 
      rowMeans(na.rm = TRUE)
    eval(str2expression(paste0("data_filtered$",
                                 format, "_", factor,
                                 " <- factor_mean_vector")))
  }
}
rm(format, factor, factor_mean_vector)
```
## Long format
```{r long formats, message=FALSE, warning=FALSE}
vars_vector <- sapply(formats,
                      function(format) {
                        paste0(format, "_", gems_factors)
                      },
                      USE.NAMES = F) %>% as.vector()
data_long_mult <- data_filtered %>% select(participant, vars_vector)
names(data_long_mult) <- names(data_long_mult) %>%
  gsub("joyful_activation", "joyfulactivation", .)
data_long_mult <- data_long_mult %>%
  pivot_longer(!participant,
               names_to = c("format", ".value"),
               names_pattern = "(.*)_(.*)")
data_long_single <- data_long_mult %>%
  pivot_longer(!c(participant, format),
               values_to = "score",
               names_to = "factor") %>% 
  mutate(factor = recode(factor,
                         joyfulactivation = "joyful activation") %>% tools::toTitleCase(),
         format = format %>% tools::toTitleCase() %>% as_factor())
names(data_long_mult) <- names(data_long_mult) %>%
  gsub("joyfulactivation", "joyful_activation", .)
```
# Analyses
## Descriptives
